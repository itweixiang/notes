### 应用部署

SvnAdmin为svn的网页管理系统，全中文的操作界面，仓库和用户的管理，也是比较完善的，完成度较高。

![image-20220728193307677](images/image-20220728193307677.png)



该管理系统由php编写，依赖php的环境。并且需要使用nginx等，对*.php文件进行映射。还需要数据库用以存储管理数据。技术栈还复杂的。

不过，该系统官方提供docker镜像部署，相对来说比较简单了。



- 初始化一个临时容器

```sh
docker run -d \
-p 80:80 \
-p 3690:3690 \
--privileged \
--name=svnadmin \
witersencom/svnadmin:2.3.2
```



- 把临时容器的配置拷贝到宿主机

container_name是临时容器的名称，/home/svnadmin是容器固定的数据存储路径，/data是拷贝下来的路径，也可以换成别的

```sh
docker cp container_name:/home/svnadmin /data
```



- 创建容器，将磁盘挂进去

/data为刚刚的拷贝路径

```
sudo docker run -d \
-p 80:80 \
-p 3690:3690 \
-v "/data":"/home/svnadmin/" \
--privileged \
--name=svnadmin \
witersencom/svnadmin:2.3.2
```



- 其他

目前的版本，容器中存在一些权限问题，已向官方反馈，并于下版本修复。需要进入到容器中，对/home/svnadmin目录授一下权

```
# 进入容器
docker exec -it container_name /bin/bash
# 授权
chmod 777 /home/svnadmin/
```



这个问题，其实在这个镜像的dockerfile中，就可以处理了。



- svn的安装

该容器中，已经内置了一个svn服务，无需另外再安装一个svn，查看一下svn的版本

![image-20220728201937750](images/image-20220728201937750.png)

一般来说，除非有比较紧急的bug，否则不建议选择最新版本。

而1.10.7，最近的更新时间是去年4月，相对来说是个比较稳定的版本。

![image-20220728202035165](images/image-20220728202035165.png)



- 安全性问题考量

由于该管理系统，仅仅是对svn管理文件进行的修改，所以并不会影响实际的数据。相当于一个壳子，数据管理还是由svn进行的，没有管理系统也不影响svn的运行，如果有bug，也是在管理系统的高级功能层面。



### 管理系统使用

#### 概览

- 登录界面可分角色登录，配合后端实现的登录验证码（验证码可后台手动关闭开启）

  ![image-20220728194858710](images/image-20220728194858710.png)

- 服务器状态监控和信息统计，对当前服务器状态和SVN仓库信息更加了解

  ![image-20220728194913664](images/image-20220728194913664.png)

#### 仓库

- SVN仓库概览，提供了多种高级功能，还可根据仓库名、版本数、体积等一键排序

  ![image-20220728194937893](images/image-20220728194937893.png)

- 仓库目录浏览更加方便 逐层加载，服务资源占用更低

  ![image-20220728195013515](images/image-20220728195013515.png)

- **仓库授权精确到文件级别，可对用户和用户组快速授权和更改权限**

  ![image-20220728195116439](images/image-20220728195116439.png)

- 可以查看每个仓库的详细信息，一键复制详细信息更加方便

  ![image-20220728195323038](images/image-20220728195323038.png)

- 可以很方便的修改仓库名称，这会自动同步配置文件

  ![image-20220728195425904](images/image-20220728195425904.png)

#### 用户管理

- SVN用户管理支持启用、禁用、添加备注信息，管理用户更加方便

  ![image-20220728195438696](images/image-20220728195438696.png)

- SVN分组支持显示其包含的用户和分组数量 同时支持修改备注信息

  ![image-20220728195457794](images/image-20220728195457794.png)

- 可以对分组进行用户成员编辑，系统会贴心的提示用户是否处于禁用状态

  ![image-20220728195510897](images/image-20220728195510897.png)

#### 备份

我们可能不会用到，而用别的方案，将整个仓库进行备份。

- 支持在线dump方式备份，备份文件可随时下载或删除

  ![image-20220728195155404](images/image-20220728195155404.png)

- 可以将通过dump方式备份的文件再导入仓库 实现SVN仓库的迁移

  ![image-20220728195339709](images/image-20220728195339709.png)

#### 其他

- 系统提供了svnserve主机和端口绑定功能 而且开启了svnserve的运行日志 为你多一层运维保障

  ![image-20220728195555336](images/image-20220728195555336.png)

- 数据存储的路径查看

  ![image-20220728195619513](images/image-20220728195619513.png)

- 配置邮件通知服务

  ![image-20220728195645529](images/image-20220728195645529.png)

  



### 数据备份

![image-20220728204237063](images/image-20220728204237063.png)



#### 云上备份

将数据打一个tar包，并进行多层加密，然后上传到云厂商的的对象存储服务器上。



#### 本地备份

在办公室，随便找一台电脑，挂块8T的磁盘，也不用做raid。装一个ubuntu系统，再装个nfs服务端，然后在svn装一个nfs客户端，将nfs挂载到svn服务器上。直接当作磁盘用。备份时，直接把数据移动到nfs挂载的目录即可。



